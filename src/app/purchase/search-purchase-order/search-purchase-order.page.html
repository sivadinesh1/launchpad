<ion-content [scrollEvents]="true" (ionScroll)="logScrolling($event)">
    <div class="search-purchase-header sticky" style="padding: 1rem">
        <div>{{this.filter_text}} PURCHASE ORDERS</div>

        <div class="full-download" style="display: flex; align-self: center">
            <button
                style="border-radius: 0px"
                appPreventDoubleClick
                class="cursor"
                type="button"
                [throttleTime]="500"
                mat-flat-button
                type="button"
                mat-stroked-button
                tabindex="-1"
                (click)="exportCompletedPurchaseToExcel()"
            >
                <mat-icon>cloud_download</mat-icon>
                &nbsp;Download
            </button>

            <span
                class="btn-grad add-btn"
                style="padding-right: 1rem; margin-left: 1rem"
                (click)="goPurchaseAddScreen()"
            >
                <mat-icon class="add-icon">add</mat-icon>
                <span style="padding: 5px">Add Purchase</span>
            </span>
        </div>
    </div>
    <div class="search-bar-purchase sticky1">
        <div>
            <img
                src="/assets/images/svg/refresh.svg"
                width="22px"
                height="22px"
                style="cursor: pointer"
                matTooltip="Reset Search Filter"
                matTooltipClass="tooltip"
                (click)="reset()"
            />
        </div>
        <div
            [matMenuTriggerFor]="menuN"
            #menuTriggerN
            style="flex: 0 0 70px; padding: 0 16px"
        >
            <img
                src="/assets/images/svg/filter-results-button.svg"
                width="22px"
                height="22px"
                style="cursor: pointer"
                matTooltip="Advance Filter"
                matTooltipClass="tooltip"
            />
        </div>

        <app-search-vendors
            (vendorOutput)="vendorInfoPage($event)"
            (vendorSearchResetOutput)="vendorSearchReset()"
        ></app-search-vendors>

        <div
            style="
                display: flex;
                align-self: center;
                font-style: italic;
                font-size: 13px;
            "
        >
            Showing&nbsp;
            <span style="font-weight: 600">{{this.filteredValues?.length}}</span
            >&nbsp;of&nbsp;<span style="font-weight: 600"
                >{{this.full_count}}</span
            >
        </div>

        <div
            class="filter_date_range"
            *ngIf="!isCustomDateFilter"
            [matMenuTriggerFor]="admin"
        >
            <div>
                <div>
                    {{this.from_date | date:'MMM dd'}} - {{this.to_date |
                    date:'dd, yyyy'}}
                </div>

                <div style="font-weight: 600">
                    Last {{this.searchByDays}} days
                </div>
            </div>
            <div style="position: relative; top: 4px">
                <img
                    src="/assets/images/svg/down-arrow.svg"
                    width="14px"
                    height="14px"
                />
            </div>
        </div>

        <ng-container *ngIf="isCustomDateFilter">
            <div class="filter_date_range">
                <div>
                    <mat-form-field style="margin-bottom: -1.25em">
                        <mat-label>Enter a date range</mat-label>
                        <mat-date-range-input [rangePicker]="picker">
                            <input
                                matStartDate
                                matInput
                                readonly
                                placeholder="Start date"
                                [ngModel]="this.from_date"
                                (dateChange)="opsFromDateEvent($event)"
                            />
                            <input
                                matEndDate
                                matInput
                                readonly
                                placeholder="End date"
                                [ngModel]="this.to_date"
                                (dateChange)="opsToDateEvent($event)"
                            />
                        </mat-date-range-input>
                        <mat-datepicker-toggle
                            matSuffix
                            [for]="picker"
                        ></mat-datepicker-toggle>
                        <mat-date-range-picker #picker></mat-date-range-picker>
                    </mat-form-field>
                </div>
            </div>
        </ng-container>
        <div
            style="padding: 0px 0px 0px 10px"
            *ngIf="isCustomDateFilter"
            (click)="customDateFilter()"
        >
            <img
                class="cursor"
                src="/assets/images/svg/close.svg"
                width="20px"
                height="20px"
            />
        </div>
    </div>

    <div class="header header-style sticky2">
        <div class="column-item">#</div>

        <div
            class="column-item"
            [ngClass]="isSelectedColumn('Date')"
            (click)="sortInvoiceDate()"
        >
            <span> R. Date </span>

            <app-descending *ngIf="this.orderDefaultFlag === 'desc'">
            </app-descending>
            <app-ascending *ngIf="this.orderDefaultFlag === 'asc'">
            </app-ascending>
        </div>
        <div class="column-item">PO #</div>
        <div class="column-item" style="padding-left: 10px">Vendor Name</div>

        <div class="column-item txt-left-align">LR #</div>
        <div class="column-item txt-right-align"># Boxes</div>
        <div class="column-item txt-right-align">Items</div>
        <div class="column-item txt-right-align">Net Total</div>
        <div>&nbsp;</div>
    </div>
    <div *ngIf="filteredValues?.length === 0" class="no-records-found">
        No records found
    </div>
    <div
        *ngFor="let item of filteredValues; let idx = index"
        class="spo-listItem"
    >
        <div>{{idx + 1}}</div>

        <div class="item">{{item.received_date | date:'d-M-yyyy' }}</div>

        <div
            class="item link-it"
            style="padding-right: 10px"
            (click)="openDialog(item)"
        >
            {{item.invoice_no}}
        </div>

        <div class="item" style="padding-left: 10px">{{item.vendor_name}}</div>

        <div class="item" style="text-align: left; padding-left: 10px">
            {{item.lr_no}}
        </div>
        <div class="item" style="text-align: right">{{item.no_of_boxes}}</div>
        <div class="item" style="text-align: right">{{item.no_of_items}}</div>

        <div class="item" style="text-align: right">
            {{item.net_total.toLocaleString('en-IN')}}
        </div>
        <div
            class="more a-link"
            style="margin-left: 16px"
            (click)="goPurchaseEditScreen(item)"
        >
            <mat-icon
                #tooltip="matTooltip"
                matTooltip="Edit"
                matTooltipClass="tooltip"
                color="primary"
                (mousedown)="tooltip.hide()"
                [ngStyle]="{ cursor: 'pointer' }"
                >edit
            </mat-icon>
        </div>
    </div>

    <mat-menu #admin="matMenu" [overlapTrigger]="false" class="myMenu">
        <div mat-menu-item class="mat-menu-line-height" (click)="dateFilter(7)">
            <span>Last 7 days</span>
        </div>

        <div
            mat-menu-item
            class="mat-menu-line-height"
            (click)="dateFilter(14)"
        >
            <span>Last 14 days</span>
        </div>
        <div mat-menu-item class="mat-menu-line-height" (click)="dateFilter(0)">
            <span>Today</span>
        </div>
        <div
            mat-menu-item
            class="mat-menu-line-height"
            (click)="customDateFilter()"
        >
            <span>Custom</span>
        </div>
    </mat-menu>

    <mat-menu #menuN="matMenu" [overlapTrigger]="false" class="myMenu">
        <div mat-menu-item class="mat-menu-line-height" (click)="openDialog1()">
            <span>By PO Invoice #</span>
        </div>
    </mat-menu>

    <!-- <mat-menu #menuN="matMenu" [overlapTrigger]="false" class="myMenu">
        <div mat-menu-item class="mat-menu-line-height" (click)="openDialog1()">
            By Purchase Invoice #
        </div>
    </mat-menu> -->

    <ng-container *ngIf="!is_loaded">
        <ion-item *ngFor="let fake of _helperUtilsService.generateFake(20)">
            <div
                style="
                    display: grid;
                    grid-template-columns: 1fr 1fr 100px 100px;
                    width: 100%;
                    gap: 10px;
                    padding: 10px;
                "
            >
                <div>
                    <ion-label text-wrap>
                        <ion-skeleton-text
                            animated
                            style="width: 120px"
                        ></ion-skeleton-text>
                        <ion-skeleton-text
                            animated
                            style="width: 150px"
                        ></ion-skeleton-text>
                        <ion-skeleton-text
                            animated
                            style="width: 100px"
                        ></ion-skeleton-text>
                    </ion-label>
                </div>
                <div>
                    <ion-label text-wrap>
                        <ion-skeleton-text
                            animated
                            style="width: 120px"
                        ></ion-skeleton-text>
                        <ion-skeleton-text
                            animated
                            style="width: 150px"
                        ></ion-skeleton-text>
                        <ion-skeleton-text
                            animated
                            style="width: 100px"
                        ></ion-skeleton-text>
                    </ion-label>
                </div>
                <div>
                    <ion-label text-wrap>
                        <ion-skeleton-text
                            animated
                            style="width: 120px"
                        ></ion-skeleton-text>
                    </ion-label>
                </div>
                <div>
                    <ion-label text-wrap>
                        <ion-skeleton-text
                            animated
                            style="width: 120px"
                        ></ion-skeleton-text>
                    </ion-label>
                </div>
            </div>
        </ion-item>
    </ng-container>

    <ng-container *ngIf="this.all_caught_up !== '' ">
        <span class="all_caught_up"> {{this.all_caught_up}} </span>
    </ng-container>

    <ion-infinite-scroll (ionInfinite)="doInfinite($event)">
        <ion-infinite-scroll-content
            loadingSpinner="bubbles"
            loadingText="Loading more data..."
        >
        </ion-infinite-scroll-content>
    </ion-infinite-scroll>
</ion-content>
